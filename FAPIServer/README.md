Core logic for FAPI Server